(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-discount-coupon-edit"],{"028a":function(e,t,i){"use strict";i.r(t);var a=i("7e06"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},"75fd":function(e,t,i){var a=i("f1bd");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("4f06").default;n("2091e3c9",a,!0,{sourceMap:!1,shadowMode:!1})},"7e06":function(e,t,i){"use strict";i("7a82");var a=i("ee27").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("d81d"),i("14d9"),i("a9e3"),i("d9e2"),i("d401");var n,o=a(i("fc11")),l=a(i("f3f3")),r=uni.vk,s={},c=(r.getVuex("$app.config.maill.coupon.type"),r.getVuex("$user.mchInfo.vip_level_rule")),u={status:1,type:1,allow_share:!1,allow_give:!1,only_original_price_use:!0,is_public:!0,coupon_rule:{min_amount:"",discount_amount:"",discount_proportion:"",amount_range:"",exchange_type:"",exchange_buy_goods_id:"",exchange_goods_id:"",voucher_amount:"",describe:"",available_count:""},available_range_rule:{type:0,goods_type:1,category_ids:[],goods_ids:[]},effective_time_rule:{type:0,start_fixed_time:"",end_fixed_time:"",start_dynamic_time:"",end_dynamic_time:""},receive_rule:{type:0,vip_ids:[],mode:0,integral:null}},d={data:function(){var e=this;return{vipLvData:c,page:{title:"",submitText:""},form1:(0,l.default)({},u),formData1:{action:"admin/business/sys.coupon.addUpdate",columns:[{key:"",title:"基础信息",type:"bar-title"},{key:"status",title:"优惠券状态",type:"radio",optionType:"button",data:[{value:0,label:"下架"},{value:1,label:"上架"}],tips:"优惠券下架不影响已发放的优惠券的使用"},{key:"name",title:"优惠券标题",type:"text",width:400,maxlength:20,showWordLimit:!0,tips:"建议填写“10元代金券”、“8折券”等易于理解的具体优惠内容，限20个字以内"},{key:"stock",title:"库存（张）",type:"number",width:220,rightText:"张"},{key:"is_public",title:"领取限制",type:"switch",width:100,activeValue:!0,inactiveValue:!1},{key:"",title:"优惠券类型",type:"bar-title"},{key:"type",title:"优惠券类型",type:"radio",itemWidth:100,data:[{value:1,label:"满减券"},{value:2,label:"折扣券"}],disabled:function(){return"update"===e.options.mode}},{key:"coupon_rule",title:"优惠规则",type:"text",width:100,showLabel:!1,disabled:function(){return"update"===e.options.mode}},{key:"",title:"可用范围规则",type:"bar-title"},{key:"available_range_rule",title:"",type:"object",width:100,showLabel:!1,columns:[{key:"type",title:"状态",type:"radio",data:[{value:0,label:"全部商品可用"},{value:1,label:"指定商品可用"},{value:2,label:"指定商品不可用"}]},{key:"goods_type",title:"指定类型",type:"radio",data:[{value:0,label:"指定分类"},{value:1,label:"指定商品"}],showRule:function(e){return e.available_range_rule.type>0}},{key:"category_ids",title:"商品分类",type:"cascader",width:400,action:"admin/business/sys.goodsCategory.kh_getList",props:{list:"rows",value:"_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1,multiple:!0},showRule:function(e){return 0==e.available_range_rule.goods_type&&e.available_range_rule.type>0}},(0,o.default)({key:"goods_ids",title:"选择商品",type:"table-select",placeholder:"请选择商品",showRule:"type>0",action:"admin/business/sys.goods.getList",multiple:!0,formData:{status:0},columns:[{key:"goods_thumb",title:"商品图",type:"avatar",imageWidth:40},{key:"name",title:"商品名称",type:"text",width:160,align:"left"},{key:"categoryList",title:"所属分类",type:"text",width:140,defaultValue:"暂无",formatter:function(e,t,i,a){var n="";return e.map((function(e,t){t>0&&(n+="、"),n+=e.name})),n}},{key:"sku_list",title:"价格区间",type:"text",width:200,defaultValue:"暂无",formatter:function(e,t,i,a){var n=[];e.map((function(e,t){n.push(Number(e.price))}));var o=Math.max.apply(Math,n),l=Math.min.apply(Math,n);return o!=l?r.pubfn.priceFilter(l)+" - "+r.pubfn.priceFilter(o):r.pubfn.priceFilter(l)}},{key:"stock",title:"商品库存",type:"number",width:110,show:["row"]}],queryColumns:[{key:"name",type:"text",title:"商品名称",placeholder:"请输入商品名称",width:220,mode:"%%"},{key:"category_ids",title:"商品分类",type:"cascader",width:250,mode:"in",action:"admin/business/sys.goodsCategory.kh_getList",props:{list:"rows",value:"_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1}},{key:"_id",title:"角色标识",type:"text",width:150,mode:"%%",show:!1}]},"showRule",(function(e){return 1==e.available_range_rule.goods_type&&e.available_range_rule.type>0}))]},{key:"",title:"领取时间",type:"bar-title"},{key:"receive_start_time",title:"最早可领取时间",type:"date",dateType:"datetime",width:220},{key:"receive_end_time",title:"最晚可领取时间",type:"date",dateType:"datetime",width:220},{key:"",title:"有效期",type:"bar-title"},{key:"effective_time_rule",title:"有效期",type:"text"},{key:"",title:"领取规则",type:"bar-title"},{key:"receive_rule",title:"领取规则",type:"text",showRule:"is_public==true"},{key:"",title:"其他规则",type:"bar-title"},{key:"only_original_price_use",title:"仅原价购买可用",type:"switch",width:110,activeValue:!0,inactiveValue:!1,tips:"开启后，用户使用该优惠券不可与其他优惠叠加。"},{key:"describe",title:"使用说明",type:"textarea",width:600,autosize:{minRows:4,maxRows:10},maxlength:200,showWordLimit:!0},{key:"",title:"其他",type:"bar-title"},{key:"remark",title:"商家备注",type:"textarea",width:600,autosize:{minRows:4,maxRows:10},maxlength:200,showWordLimit:!0}],rules:{name:[{required:!0,message:"优惠券标题不能为空",trigger:["blur","change"]}],stock:[{type:"number",min:0,required:!0,message:"优惠券库存必须>0",trigger:["blur","change"]}],type:[{type:"number",required:!0,message:"优惠券类型不可为空",trigger:["blur","change"]}],coupon_rule:[{validator:function(t,i,a){var n=e.form1,o=void 0===n?{}:n;1===o.type?i.discount_amount<=0&&a(new Error("优惠金额错误，必须>0")):2===o.type&&(i.discount_proportion<=0||i.discount_proportion>=1)&&a(new Error("折扣错误，必须在0折和10折之间")),a()},trigger:["blur","change"]}]},formType:"",show:!1,loading:!1}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n=this,r=n.vk,n.options=e,n.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{init:function(e){if("update"===e.mode)n.page.title="优惠券编辑",n.page.submitText="修改",r.callFunction({url:"admin/business/sys.coupon.find",title:"请求中...",data:{_id:e._id},success:function(e){var t=r.pubfn.copyObject(u);n.form1=r.pubfn.objectAssign(t,e.info),s["form1"]=r.pubfn.copyObject(n.form1)}});else{n.page.title="优惠券添加",n.page.submitText="添加",s["form1"]=r.pubfn.copyObject(u);var t=this.getOpenerEventChannel();t.on&&t.on("data",(function(e){var t=r.pubfn.copyObject(u);n.form1=r.pubfn.objectAssign(t,e),s["form1"]=r.pubfn.copyObject(n.form1)}))}},pageTo:function(e){r.navigateTo(e)},pageBack:function(){var e=getCurrentPages();e.length>1&&e[0].route!==n.$page.route?r.navigateBack():r.navigateTo("list")},resetForm:function(){r.pubfn.resetForm(s,n)},submitForm:function(){n.form1.mode=n.options.mode,n.$refs.form1.submitForm()},formSuccess:function(e){n.$alert(e.data.msg,"提示",{confirmButtonText:"确定",callback:function(e){r.navigateTo("list")}})}},watch:{},computed:{}};t.default=d},"8fdd":function(e,t,i){"use strict";var a=i("75fd"),n=i.n(a);n.a},d568:function(e,t,i){"use strict";i.r(t);var a=i("e2f4"),n=i("028a");for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);i("8fdd");var l=i("f0c5"),r=Object(l["a"])(n["default"],a["b"],a["c"],!1,null,"3cb3a6a7",null,!1,a["a"],void 0);t["default"]=r.exports},e2f4:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"page"},[i("vk-data-page-header",{attrs:{title:e.page.title,"show-back":!0},on:{back:function(t){arguments[0]=t=e.$handleEvent(t),e.pageBack.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"page-body"},[i("vk-data-form",{ref:"form1",attrs:{rules:e.formData1.rules,action:e.formData1.action,"form-type":e.formData1.formType,columns:e.formData1.columns,"label-width":"140px","max-height":"calc(100vh - 210px)","footer-show":!1,loading:e.formData1.loading,"before-action":e.formData1.beforeAction},on:{"update:loading":function(t){arguments[0]=t=e.$handleEvent(t),e.$set(e.formData1,"loading",t)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.formSuccess.apply(void 0,arguments)}},scopedSlots:e._u([{key:"coupon_rule",fn:function(t){var a=t.form,n=t.keyName;return[i("v-uni-view",{staticStyle:{"margin-left":"60px"}},[1===a.type?i("v-uni-view",{staticStyle:{color:"#606266"}},[i("v-uni-text",[e._v("优惠力度：")]),i("v-uni-text",[e._v("满")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-money",{attrs:{precision:0,width:"140px",clearable:!1,placeholder:"多少",rightText:"元",disabled:"update"===e.options.mode},model:{value:a[n].min_amount,callback:function(t){e.$set(a[n],"min_amount",t)},expression:"form[keyName].min_amount"}})],1),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[e._v("，减")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-money",{attrs:{precision:0,width:"140px",clearable:!1,placeholder:"多少",rightText:"元",disabled:"update"===e.options.mode},model:{value:a[n].discount_amount,callback:function(t){e.$set(a[n],"discount_amount",t)},expression:"form[keyName].discount_amount"}})],1)],1):2===a.type?i("v-uni-view",{staticStyle:{color:"#606266"}},[i("v-uni-text",[e._v("折扣力度：")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-discount",{attrs:{precision:0,width:"140px",clearable:!1,placeholder:"多少",rightText:"折",disabled:"update"===e.options.mode},model:{value:a[n].discount_proportion,callback:function(t){e.$set(a[n],"discount_proportion",t)},expression:"form[keyName].discount_proportion"}})],1)],1):e._e()],1)]}},{key:"effective_time_rule",fn:function(t){var a=t.form,n=t.keyName;return[i("v-uni-view",{staticStyle:{color:"#606266"}},[i("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),a[n].type=0}}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:0},model:{value:a[n].type,callback:function(t){e.$set(a[n],"type",t)},expression:"form[keyName].type"}},[e._v("固定时间：")]),i("vk-data-input-date-time",{attrs:{type:"datetime",disabled:0!=a[n].type},model:{value:a[n].start_fixed_time,callback:function(t){e.$set(a[n],"start_fixed_time",t)},expression:"form[keyName].start_fixed_time"}}),i("v-uni-text",{staticStyle:{margin:"0 5px"}},[e._v("-")]),i("vk-data-input-date-time",{attrs:{type:"datetime",disabled:0!=a[n].type},model:{value:a[n].end_fixed_time,callback:function(t){e.$set(a[n],"end_fixed_time",t)},expression:"form[keyName].end_fixed_time"}})],1),i("v-uni-view",{staticStyle:{"margin-top":"20px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),a[n].type=1}}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:1},model:{value:a[n].type,callback:function(t){e.$set(a[n],"type",t)},expression:"form[keyName].type"}},[e._v("领取：")]),i("v-uni-text",[i("vk-data-input-number",{attrs:{precision:0,width:"200px",placeholder:"请输入天数",rightText:"天",clearable:!1,disabled:1!=a[n].type},model:{value:a[n].start_dynamic_time,callback:function(t){e.$set(a[n],"start_dynamic_time",t)},expression:"form[keyName].start_dynamic_time"}})],1),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[e._v("生效，有效期")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-number",{attrs:{precision:0,width:"200px",placeholder:"请输入天数",rightText:"天",clearable:!1,disabled:1!=a[n].type},model:{value:a[n].end_dynamic_time,callback:function(t){e.$set(a[n],"end_dynamic_time",t)},expression:"form[keyName].end_dynamic_time"}})],1)],1)],1)]}},{key:"is_public",fn:function(t){var a=t.form,n=t.keyName;return[i("v-uni-view",{staticStyle:{color:"#606266"}},[i("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),a[n]=!0}}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:!0},model:{value:a[n],callback:function(t){e.$set(a,n,t)},expression:"form[keyName]"}},[e._v("限领：")]),i("v-uni-text",[i("vk-data-input-number",{attrs:{precision:0,width:"150px",placeholder:"",rightText:"张",clearable:!1,disabled:1!=a[n]},model:{value:a.limit,callback:function(t){e.$set(a,"limit",t)},expression:"form.limit"}})],1),i("v-uni-text",{staticStyle:{"margin-left":"10px",color:"#9FA5BB"}},[e._v("填0或不填代表不限制（商家赠送，营销活动赠送不受此限制）")])],1),i("v-uni-view",{staticStyle:{"margin-top":"20px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),a[n]=!1}}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:!1},model:{value:a[n],callback:function(t){e.$set(a,n,t)},expression:"form[keyName]"}},[e._v("不可自主领取：")]),i("v-uni-text",{staticStyle:{"margin-left":"10px",color:"#9FA5BB"}},[e._v("选择后将不展示在优惠券列表中，只能通过商家后台发放")])],1)],1)]}},{key:"receive_rule",fn:function(t){var a=t.form,n=t.keyName;return[i("v-uni-view",{staticStyle:{color:"#606266"}},[i("v-uni-view",[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:0},model:{value:a[n].type,callback:function(t){e.$set(a[n],"type",t)},expression:"form[keyName].type"}},[e._v("所有用户")])],1),i("v-uni-view",{staticStyle:{"margin-top":"10px"}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:1},model:{value:a[n].type,callback:function(t){e.$set(a[n],"type",t)},expression:"form[keyName].type"}},[e._v("所有会员（Lv>=1）")])],1),i("v-uni-view",{staticStyle:{"margin-top":"10px"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),a[n].type=2}}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:2},model:{value:a[n].type,callback:function(t){e.$set(a[n],"type",t)},expression:"form[keyName].type"}},[e._v("指定会员等级")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-select",{attrs:{localdata:e.vipLvData,placeholder:"请选择",multiple:!0,props:{value:"lv",label:"name",children:"children"},clearable:!1,disabled:2!=a[n].type},model:{value:a[n].vip_ids,callback:function(t){e.$set(a[n],"vip_ids",t)},expression:"form[keyName].vip_ids"}})],1)],1),i("v-uni-view",{staticStyle:{"margin-top":"20px"}},[e._v("积分")]),i("v-uni-view",{staticStyle:{"margin-top":"10px"}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:0},model:{value:a[n].mode,callback:function(t){e.$set(a[n],"mode",t)},expression:"form[keyName].mode"}},[e._v("领取无需扣除积分")])],1),i("v-uni-view",{staticStyle:{"margin-top":"10px"}},[i("el-radio",{staticStyle:{width:"80px"},attrs:{label:1},model:{value:a[n].mode,callback:function(t){e.$set(a[n],"mode",t)},expression:"form[keyName].mode"}},[e._v("领取需要扣除")]),i("v-uni-text",{staticStyle:{"margin-left":"10px"}},[i("vk-data-input-number",{attrs:{precision:0,width:"160px",placeholder:"多少",rightText:"积分",clearable:!1,disabled:1!=a[n].mode},model:{value:a[n].integral,callback:function(t){e.$set(a[n],"integral",t)},expression:"form[keyName].integral"}})],1)],1)],1)]}}]),model:{value:e.form1,callback:function(t){e.form1=t},expression:"form1"}})],1),i("v-uni-view",{staticClass:"page-footer"},[i("el-button",{staticStyle:{width:"80px"},attrs:{loading:e.formData1.loading,type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm.apply(void 0,arguments)}}},[e._v(e._s(e.page.submitText))]),i("el-button",{staticStyle:{"margin-left":"20px",width:"80px"},attrs:{plain:!0},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.pageBack.apply(void 0,arguments)}}},[e._v("返回")])],1),i("v-uni-view",{staticClass:"page-dialog"})],1)},n=[]},f1bd:function(e,t,i){var a=i("24fb");t=a(!1),t.push([e.i,"",""]),e.exports=t}}]);