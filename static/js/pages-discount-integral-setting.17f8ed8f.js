(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-discount-integral-setting"],{"1b3b":function(e,t,a){"use strict";a("7a82");var i=a("ee27").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=i(a("fc11"));a("d81d"),a("14d9"),a("a9e3"),a("d9e2"),a("d401");var l=uni.vk,r={data:function(){return{data:{},page:{title:"积分规则",submitText:"设置",cancelText:"返回",showBack:!1,backPage:"",complete:!1},form1:{data:{enable:!1,discount_rule:{a:"",b:"",c:""},available_range_rule:{type:"",goods_type:1,category_ids:[],goods_ids:[]},disable_vip:!1,disable_coupon:!1},props:{action:"admin/business/sys.integral.updateSetting",columns:[{key:"enable",title:"是否启用积分优惠",type:"switch",activeValue:!0,inactiveValue:!1,tips:"只有此开关开启后，下面的积分规则才生效。"},{key:"",title:"抵扣规则",type:"bar-title"},{key:"discount_rule",title:"",type:"text",tips:"注意：订单实付金额只计算可用范围规则内的商品金额，且不含运费。"},{key:"",title:"优惠叠加规则",type:"bar-title"},{key:"disable_vip",title:"会员折扣",type:"radio",optionType:"button",data:[{value:!0,label:"禁用"},{value:!1,label:"可用"}]},{key:"disable_coupon",title:"优惠券",type:"radio",optionType:"button",data:[{value:!0,label:"禁用"},{value:!1,label:"可用"}]},{key:"",title:"可用范围规则",type:"bar-title"},{key:"available_range_rule",title:"",type:"object",width:100,showLabel:!1,columns:[{key:"type",title:"状态",type:"radio",data:[{value:0,label:"全部商品可用"},{value:1,label:"指定商品可用"},{value:2,label:"指定商品不可用"}]},{key:"goods_type",title:"指定类型",type:"radio",data:[{value:0,label:"指定分类"},{value:1,label:"指定商品"}],showRule:function(e){return e.available_range_rule.type>0}},{key:"category_ids",title:"商品分类",type:"cascader",width:400,action:"admin/business/sys.goodsCategory.kh_getList",props:{list:"rows",value:"_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1,multiple:!0},showRule:function(e){return 0==e.available_range_rule.goods_type&&e.available_range_rule.type>0}},(0,o.default)({key:"goods_ids",title:"选择商品",type:"table-select",placeholder:"请选择商品",showRule:"type>0",action:"admin/business/sys.goods.getList",multiple:!0,formData:{status:0},columns:[{key:"goods_thumb",title:"商品图",type:"avatar",imageWidth:40},{key:"name",title:"商品名称",type:"text",width:160,align:"left"},{key:"categoryList",title:"所属分类",type:"text",width:140,defaultValue:"暂无",formatter:function(e,t,a,i){var n="";return e.map((function(e,t){t>0&&(n+="、"),n+=e.name})),n}},{key:"sku_list",title:"价格区间",type:"text",width:200,defaultValue:"暂无",formatter:function(e,t,a,i){var n=[];e.map((function(e,t){n.push(Number(e.price))}));var o=Math.max.apply(Math,n),r=Math.min.apply(Math,n);return o!=r?l.pubfn.priceFilter(r)+" - "+l.pubfn.priceFilter(o):l.pubfn.priceFilter(r)}},{key:"stock",title:"商品库存",type:"number",width:110,show:["row"]}],queryColumns:[{key:"name",type:"text",title:"商品名称",placeholder:"请输入商品名称",width:220,mode:"%%"},{key:"category_ids",title:"商品分类",type:"cascader",width:250,mode:"in",action:"admin/business/sys.goodsCategory.kh_getList",props:{list:"rows",value:"_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1}},{key:"_id",title:"角色标识",type:"text",width:150,mode:"%%",show:!1}]},"showRule",(function(e){return 1==e.available_range_rule.goods_type&&e.available_range_rule.type>0}))]}],rules:{discount_rule:[{validator:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,i=t.a,n=t.b,o=t.c,r=l.pubfn.isNullOneByObject({a:i,b:n,c:o});r&&a(new Error("请完善抵扣规则")),(i<=0||n<=0||o<=0)&&a(new Error("抵扣规则填写错误：数值必须都大于0")),o>i&&a(new Error("抵扣规则填写错误：积分抵扣金额不能大于订单金额")),a()},trigger:["blur","change"]}]},labelWidth:"150px",loading:!1,successMsg:"设置成功",beforeAction:function(e){return(0,o.default)({},"integral_rule",e)}}},goodsSelect:{action:"admin/business/sys.goods.getList",multiple:!0,formData:{status:0},columns:[{key:"goods_thumb",title:"商品图",type:"avatar",imageWidth:40},{key:"name",title:"商品名称",type:"text",width:160,align:"left"},{key:"categoryList",title:"所属分类",type:"text",width:140,defaultValue:"暂无",formatter:function(e,t,a,i){var n="";return e.map((function(e,t){t>0&&(n+="、"),n+=e.name})),n}},{key:"sku_list",title:"价格区间",type:"text",width:200,defaultValue:"暂无",formatter:function(e,t,a,i){var n=[];e.map((function(e,t){n.push(Number(e.price))}));var o=Math.max.apply(Math,n),r=Math.min.apply(Math,n);return o!=r?l.pubfn.priceFilter(r)+" - "+l.pubfn.priceFilter(o):l.pubfn.priceFilter(r)}},{key:"stock",title:"商品库存",type:"number",width:110,show:["row"]}],queryColumns:[{key:"name",type:"text",title:"商品名称",placeholder:"请输入商品名称",width:220,mode:"%%"},{key:"category_ids",title:"商品分类",type:"cascader",width:250,mode:"in",action:"admin/business/sys.goodsCategory.kh_getList",props:{list:"rows",value:"_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1}},{key:"_id",title:"角色标识",type:"text",width:150,mode:"%%",show:!1}]}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n=this,l=n.vk,n.options=e,n.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{init:function(e){n.$nextTick((function(){var e=l.getVuex("$user.mchInfo");n.initData(e),n.page.complete=!0,l.callFunction({url:"client/pub.getMchInfo",loading:{that:n,name:"form1.props.loading"},data:{},success:function(e){n.initData(e.mchInfo),l.setVuex("$user.mchInfo",e.mchInfo)}})}))},initData:function(e){l.pubfn.objectAssign(this.form1.data,e["integral_rule"])},pageTo:function(e){l.navigateTo(e)},pageBack:function(){var e=getCurrentPages();e.length>1&&e[0].route!==n.$page.route?l.navigateBack():n.page.backPage&&l.navigateTo(n.page.backPage)},resetForm:function(){n.$refs.form1.resetForm()},submitForm:function(){n.$refs.form1.submitForm()},formSuccess:function(e){l.setVuex("$user.mchInfo",e.data.mchInfo)}},watch:{},computed:{}};t.default=r},"5b50":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page"},[a("vk-data-page-header",{attrs:{title:e.page.title,"show-back":e.page.showBack},on:{back:function(t){arguments[0]=t=e.$handleEvent(t),e.pageBack.apply(void 0,arguments)}}}),e.page.complete?a("v-uni-view",{directives:[{name:"loading",rawName:"v-loading",value:e.form1.props.loading,expression:"form1.props.loading"}],staticClass:"page-body"},[a("vk-data-form",{ref:"form1",attrs:{rules:e.form1.props.rules,action:e.form1.props.action,"form-type":e.form1.props.formType,columns:e.form1.props.columns,loading:e.form1.props.loading,labelWidth:e.form1.props.labelWidth,"footer-show":!1,size:"small","success-msg":e.form1.props.successMsg,"before-action":e.form1.props.beforeAction},on:{"update:loading":function(t){arguments[0]=t=e.$handleEvent(t),e.$set(e.form1.props,"loading",t)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.formSuccess.apply(void 0,arguments)}},scopedSlots:e._u([{key:"discount_rule",fn:function(t){var i=t.form,n=(t.keyName,t.column);return[a("v-uni-view",{staticStyle:{color:"#606266","font-size":"14px"}},[a("v-uni-view",{staticStyle:{display:"flex"}},[a("v-uni-text",[e._v("订单实付金额每满")]),a("vk-data-input-money",{staticStyle:{margin:"0 10px"},attrs:{precision:2,max:1e7,width:"100px",placeholder:"多少",size:"small"},model:{value:i.discount_rule.a,callback:function(t){e.$set(i.discount_rule,"a",t)},expression:"form.discount_rule.a"}}),a("v-uni-text",[e._v("元，可用")]),a("vk-data-input-number",{staticStyle:{margin:"0 10px"},attrs:{precision:0,max:1e7,width:"100px",placeholder:"多少",size:"small"},model:{value:i.discount_rule.b,callback:function(t){e.$set(i.discount_rule,"b",t)},expression:"form.discount_rule.b"}}),a("v-uni-text",[e._v("积分抵扣")]),a("vk-data-input-money",{staticStyle:{margin:"0 10px"},attrs:{precision:2,max:1e7,width:"100px",placeholder:"多少",size:"small"},model:{value:i.discount_rule.c,callback:function(t){e.$set(i.discount_rule,"c",t)},expression:"form.discount_rule.c"}}),a("v-uni-text",[e._v("元")])],1),a("vk-data-tips",{attrs:{tips:n.tips}})],1)]}}],null,!1,1936732185),model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1):e._e(),a("v-uni-view",{staticClass:"page-footer"},[e.page.showBack?a("el-button",{staticStyle:{"margin-right":"20px",width:"80px"},attrs:{plain:!0,loading:e.form1.props.loading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.pageBack.apply(void 0,arguments)}}},[e._v(e._s(e.page.cancelText))]):e._e(),a("el-button",{staticStyle:{width:"80px"},attrs:{type:"primary",loading:e.form1.props.loading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm.apply(void 0,arguments)}}},[e._v(e._s(e.page.submitText))])],1),a("v-uni-view",{staticClass:"page-dialog"})],1)},n=[]},"7b7d":function(e,t,a){"use strict";a.r(t);var i=a("1b3b"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);t["default"]=n.a},"7ece":function(e,t,a){"use strict";a.r(t);var i=a("5b50"),n=a("7b7d");for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);var l=a("f0c5"),r=Object(l["a"])(n["default"],i["b"],i["c"],!1,null,"0044d758",null,!1,i["a"],void 0);t["default"]=r.exports}}]);